# Digital Vending Machine - BASYS-3 FPGA

BASYS-3 보드를 이용한 디지털 자판기 구현 프로젝트

## 프로젝트 개요

Xilinx BASYS-3 FPGA 보드와 Vivado를 사용하여 구현한 디지털 자판기 시스템입니다. 동전 투입, 커피 구매, 잔돈 반환 기능을 제공하며, 4자리 7-segment 디스플레이로 잔고를 표시합니다.

## 주요 기능

### 동전 투입 시스템
- **100원 동전**: Left 버튼으로 투입
- **500원 동전**: Down 버튼으로 투입  
- **최대 잔고**: 9999원 (오버플로우 방지)
- **실시간 잔고 표시**: 7-segment 디스플레이

### 커피 구매 시스템
- **커피 가격**: 300원
- **구매 조건**: 잔고 300원 이상일 때만 구매 가능
- **제조 애니메이션**: 2초간 서클 패턴 애니메이션 표시
- **자동 잔액 차감**: 구매 시 300원 자동 차감

### 동전 반환 시스템
- **점진적 반환**: 0.25초마다 100원씩 차감
- **애니메이션 효과**: 반환 과정 시각적 표시
- **완전 반환**: 모든 잔고가 0원이 될 때까지 반환

## 사용법

### 버튼 기능
- **btn[0] (Left)**: 100원 동전 투입
- **btn[1] (Center)**: 커피 구매
- **btn[2] (Right)**: 동전 반환
- **btn[3] (Down)**: 500원 동전 투입
- **reset**: 시스템 전체 리셋

### 디스플레이
- **7-segment Display**: 현재 잔고 표시 (0000~9999원)
- **커피 제조 중**: 외곽 세그먼트 회전 애니메이션 (2초간)
- **동전 반환 중**: 잔고가 점진적으로 감소하는 모습 표시

### 사용 시나리오
1. **동전 투입**: btn[0] 또는 btn[3]으로 100원/500원 투입
2. **잔고 확인**: 7-segment 디스플레이에서 현재 잔고 확인
3. **커피 구매**: btn[1] 눌러서 커피 구매 (300원 이상일 때)
4. **제조 관찰**: 2초간 서클 애니메이션으로 제조 과정 표시
5. **잔돈 반환**: btn[2]로 남은 잔고 모두 반환

## 시스템 구조

```
vending_machine_top (최상위 모듈)
├── button_debounce.v (×4) - 각 버튼 디바운싱 (10ms)
├── vending_machine_core - 자판기 핵심 로직
│   ├── 동전 투입 처리 (100원/500원)
│   ├── 커피 구매 로직 (300원 차감)
│   ├── 동전 반환 로직 (점진적 반환)
│   ├── 서클 애니메이션 생성 (2초, 0.3초 주기)
│   └── 상태 관리 (일반/제조/반환 모드)
└── fnd_controller.v - 7-segment 제어
    ├── fnd_digit_select.v - 1ms 멀티플렉싱
    ├── bin2bcd.v - 이진-BCD 변환  
    └── fnd_display.v - 세그먼트 패턴 생성
```

## 주요 모듈 설명

### 자판기 핵심 로직 (`vending_machine_core`)
- **잔고 관리**: 14비트 레지스터로 0~9999원 관리
- **상태 머신**: 일반 모드 → 커피 제조 → 동전 반환 상태 전환
- **타이머 제어**: 
  - 커피 제조: 2초 (200,000,000 클럭)
  - 패턴 변경: 0.3초 (30,000,000 클럭)
  - 동전 반환: 0.25초 (25,000,000 클럭)

### 애니메이션 시스템
- **서클 패턴**: 외곽 6개 세그먼트 (a→b→c→d→e→f) 순환
- **패턴 변경**: 0.3초마다 다음 세그먼트로 이동
- **동시 표시**: 4개 자릿수 모두에 동일한 패턴 표시

### 디스플레이 제어
- **멀티플렉싱**: 1ms마다 자릿수 전환
- **모드 전환**: 일반 모드(잔고 표시) ↔ 애니메이션 모드
- **Common Anode**: 0=켜짐, 1=꺼짐 방식

## 동작 원리

### 상태 머신
```
[일반 모드] ←→ [커피 제조 모드] (2초)
     ↓
[동전 반환 모드] (잔고가 0이 될 때까지)
```

### 타이밍 다이어그램
```
동전 투입 → 잔고 증가 → 커피 구매 → 애니메이션(2초) → 일반 모드
                ↓
           동전 반환 → 점진적 감소(0.25초 주기) → 잔고 0
```

## 빌드 및 실행

### 필요 환경
- **FPGA 보드**: Xilinx BASYS-3
- **개발 도구**: Vivado Design Suite
- **언어**: Verilog HDL

### 필요한 파일
- `top.v`: 최상위 모듈 (`vending_machine_top`)
- `vending_machine.v`: 자판기 핵심 로직 (`vending_machine_core`)
- `button_debounce.v`: 버튼 디바운싱 모듈
- `fnd_controller.v`: 7-segment 디스플레이 제어

### 실행 단계
1. Vivado에서 새 프로젝트 생성
2. 필요한 `.v` 파일들을 프로젝트에 추가
3. `vending_machine_top`을 최상위 모듈로 설정
4. BASYS-3 제약 파일(.xdc) 추가
5. Synthesis → Implementation → Generate Bitstream
6. BASYS-3 보드에 프로그래밍

## 리소스 사용량

- **클럭 도메인**: 100MHz 메인 클럭
- **카운터**: 
  - 애니메이션 카운터: 28비트 (200,000,000)
  - 패턴 타이머: 28비트 (30,000,000) 
  - 반환 타이머: 28비트 (25,000,000)
- **레지스터**: 14비트 잔고 레지스터
- **I/O 핀**: 버튼 4개, 7-segment 출력, 리셋 1개

## 특징

- **안전한 거래**: 오버플로우 방지 로직으로 안전한 동전 투입
- **직관적인 UI**: 실시간 잔고 표시와 애니메이션 피드백
- **안정적인 입력**: 10ms 디바운싱으로 깨끗한 버튼 처리
- **점진적 반환**: 실제 자판기처럼 동전을 하나씩 반환
- **상태 관리**: 명확한 상태 전환으로 안정적인 동작

## 확장 가능성

- **다양한 상품**: 가격이 다른 여러 상품 추가
- **동전 종류**: 10원, 50원 등 다양한 동전 지원
- **재고 관리**: 상품별 재고 수량 관리
- **영수증**: 구매 내역 출력 기능

---
**개발 환경**: Xilinx Vivado | **타겟 보드**: BASYS-3 | **언어**: Verilog HDL